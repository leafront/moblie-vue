{"remainingRequest":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shanliguo/Documents/wm-mobile/mobile-vue/src/view/business/business-detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/src/view/business/business-detail.vue","mtime":1554341241316},{"path":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/node_modules/cache-loader/dist/cjs.js","mtime":1551093967131},{"path":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/node_modules/babel-loader/lib/index.js","mtime":1551093966843},{"path":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/node_modules/cache-loader/dist/cjs.js","mtime":1551093967131},{"path":"/Users/shanliguo/Documents/wm-mobile/mobile-vue/node_modules/vue-loader/lib/index.js","mtime":1551093973497}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n    Tag,\n    Col,\n    Icon,\n    Cell,\n    CellGroup,\n    Swipe,\n    Toast,\n    SwipeItem,\n    GoodsAction,\n    GoodsActionBigBtn,\n    GoodsActionMiniBtn\n} from 'vant';\nimport storeData from './store/business-detail';\nimport ajax from '@/api/business';\nimport moment from 'moment';\nimport {orderStatus, refundStatus} from '@/filters/status';\n\nexport default {\n    components: {\n        [Tag.name]: Tag,\n        [Col.name]: Col,\n        [Icon.name]: Icon,\n        [Cell.name]: Cell,\n        [CellGroup.name]: CellGroup,\n        [Swipe.name]: Swipe,\n        [SwipeItem.name]: SwipeItem,\n        [GoodsAction.name]: GoodsAction,\n        [GoodsActionBigBtn.name]: GoodsActionBigBtn,\n        [GoodsActionMiniBtn.name]: GoodsActionMiniBtn,\n        Toast\n    },\n\n    data() {\n        return Object.assign(storeData.call(this), {\n            queryOrder: {\n                orderNo: ''\n            },\n            queryOrderType: '',\n            businessInfo: {\n                tradeStatusText: '', // 展示状态\n                tradeOrderName: '',\n                tradeAmount: '',\n                tradeType: this.$route.query.tradeType,\n                discountAmount: '',\n                tradeOrderNo: '',\n                operatorName: '',\n                createTime: '',\n                remark: ''\n            },\n            // orderStatus: '',\n            refundShow: false,\n            cancelShow: false,\n            overdrawStatus: false, // 是否超时30天,\n            resultForm: false, // 是否从退款状态页 来的\n            resultStatus: undefined, // 从退款状态页来的， 退款的成败状态\n            primaryNo: '', // resultForm,resultStatus基础上下个操作\n        });\n    },\n    created() {\n        this.queryOrder.orderNo = this.$route.query.tradeOrderNo;\n        this.queryOrderType = this.$route.query.tradeType === '1' ? 'pay' : this.$route.query.tradeType === '0' ? 'refund' : '';\n        this.primaryNo\n\n        this.getOrderDetail();\n\n        this.resultForm = this.$route.query.resultForm || false;\n        if (this.$route.query.resultForm) {\n            this.resultStatus = this.$route.query.resultStatus;\n        }\n    },\n    methods: {\n        getOrderDetail() {\n\n            if (this.queryOrderType === 'pay') {\n                this.getPayDetail();\n            }\n\n            if (this.queryOrderType === 'refund') {\n                this.getRefundDetail();\n            }\n        },\n\n        getPayDetail() {\n            ajax.getPay({payOrderNo: this.queryOrder.orderNo}).then(response => {\n                if (!response.success === true) {\n                    this.businessInfo = {};\n                    return;\n                } else {\n                    this.businessInfo = {\n                        ...this.businessInfo,\n                        tradeOrderName: response.data.payOrderName || '',\n                        tradeAmount: response.data.buyerPayAmount || '',\n                        discountAmount: response.data.discountAmount || '',\n                        tradeOrderNo: response.data.payOrderNo || '',\n                        operatorName: response.data.operName || '',\n                        createTime: response.data.createTime || '',\n                        remark: response.data.paySubmitRemark || '',\n                        tradeStatusText: orderStatus(response.data.payOrderStatus)\n                    };\n\n                    if (response.data.payOrderStatus === '2' ||\n                        response.data.payOrderStatus === 2) { //支付成功\n                        this.refundShow = true;\n                    } else {\n                        this.refundShow = false;\n                    }\n\n                    // 是否超过30天的逻辑\n                    if (response.data.createTime) {\n                        const thirtydaystime = moment(response.data.createTime).valueOf() + 30 * 24 * 60 * 60 * 1000;\n                        const currentTime = moment(new Date()).valueOf();\n\n                        if (thirtydaystime < currentTime) {\n                            this.overdrawStatus = true;\n                        } else {\n                            this.overdrawStatus = false;\n                        }\n                    }\n                }\n            }).catch(() => {\n                this.businessInfo = {};\n            });\n        },\n        getRefundDetail() {\n            ajax.getRefund({refundOrderNo: this.queryOrder.orderNo}).then(response => {\n                if (!response.success === true) {\n                    this.businessInfo = {};\n                    return;\n                } else {\n                    this.businessInfo = {\n                        ...this.businessInfo,\n                        tradeOrderName: response.data.payOrderName || '',\n                        tradeAmount: response.data.buyerPayAmount || '',\n                        discountAmount: response.data.discountAmount || '',\n                        operatorName: response.data.operName || '',\n                        createTime: response.data.createTime || '',\n                        remark: response.data.paySubmitRemark || ''\n                    };\n\n                    if (this.resultForm && this.resultStatus === '0') {\n                        this.primaryNo = response.data.payOrderNo;\n                    }\n                }\n            }).catch(() => {\n                this.businessInfo = {};\n            });\n        },\n        refundAction() {\n            setTimeout(() => {\n                this.$router.push({\n                    name: 'businessRefund',\n                    query: {\n                        tradeOrderNo: this.$route.query.tradeOrderNo,\n                        amount: this.businessInfo.tradeAmount,\n                        tradeType: this.$route.query.tradeType\n                    }\n                });\n            }, 800);\n        },\n        cancelAction() {\n            ajax.cancel({payOrderNo: this.queryOrder.orderNo}).then(response => {\n                if (!response.success === true) {\n                    this.$toast(response.data.msg || '撤销订单失败');\n                    return;\n                } else {\n\n                }\n            }).catch(() => {\n                this.$toast('撤销订单失败');\n            });\n        },\n        ensureAction() {\n            this.navBackClick();\n        },\n        primaryOrderAction() {\n            setTimeout(() => {\n                this.$router.push({\n                    name: 'businessDetail',\n                    query: {\n                        tradeOrderNo: this.primaryNo,\n                        tradeType: '1',\n                    }\n                });\n            }, 800);\n        },\n        navBackClick() {\n            setTimeout(() => {\n                this.$router.push({\n                    name: 'business',\n                    query: {\n                        date: this.$route.query.date,\n                        orderStatusStr: this.$route.query.orderStatusStr\n                    }\n                });\n            }, 800);\n        },\n    }\n};\n",{"version":3,"sources":["business-detail.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"business-detail.vue","sourceRoot":"src/view/business","sourcesContent":["<template>\n    <div>\n        <van-nav-bar\n                class=\"bar-wrapper\"\n                :title=\"this.$route.meta.title\"\n                left-arrow\n                :z-index=\"999\"\n                @click-left=\"navBackClick\"\n        />\n        <div class=\"business_detail-wrapper container-wrapper\">\n            <div class=\"business_detail-container\">\n                <div class=\"detail-item\">\n                    <div class=\"detail-item-name\">{{businessInfo.tradeOrderName}}</div>\n                    <div class=\"detail-item-title mt10\">\n                        {{businessInfo.tradeType|$_filters_moneyMark}}{{businessInfo.tradeAmount |\n                        $_filters_moneyFormat_fen}}\n                    </div>\n                    <div class=\"detail-item-tip mt2\">{{businessInfo.tradeStatusText}}</div>\n                </div>\n                <div class=\"detail-cells plr16\">\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">交易类型</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.tradeType==='1' ? '消费' : businessInfo.tradeType==='0' ? '退款' : ''}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\" v-if=\"businessInfo.discountAmount\">\n                        <label class=\"detail-cell-label\">优惠金额（元）</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.discountAmount | $_filters_moneyFormat_fen}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">支付方式</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.payType || '-'}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">微信订单号</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.tradeThirdNo || '-'}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">支付流水号</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.tradeOrderNo || '-'}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">操作人</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">{{businessInfo.operatorName || '-'}}</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\">\n                        <label class=\"detail-cell-label\">创建时间</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\" v-if=\"businessInfo.createTime\">{{businessInfo.createTime|$_filters_parseTime}}</span>\n                            <span class=\"detail-cell-span\" v-else>'-'</span>\n                        </div>\n                    </div>\n                    <div class=\"detail-cell\" v-if=\"businessInfo.remark\">\n                        <label class=\"detail-cell-label\">备注</label>\n                        <div class=\"detail-cell-right\">\n                            <span class=\"detail-cell-span\">\n                                <span\n                                        style=\"text-align: justify;\n                                               display: inline-block;\n                                               overflow-wrap: break-word;\"\n                                >{{businessInfo.remark}}</span>\n                            </span>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"overdraw-item plr16 ptb10\"\n                     v-if=\"queryOrderType === 'pay' && overdrawStatus\"\n                >\n                    已超过30天可退款时间，不可退款\n                </div>\n                <div class=\"overdraw-item plr16 ptb10\"\n                     v-if=\"resultForm && resultStatus==='0'\"\n                >\n                    <span class=\"info cursor\" @click=\"primaryOrderAction()\">查看原订单</span>\n                </div>\n            </div>\n\n            <div class=\"mt30 plr16\">\n                <button\n                        class=\"\n                         btn\n                         btn-block\n                         btn-ghost\n                         mb16\n                         \"\n                        v-if=\"refundShow\"\n                        @click=\"refundAction()\">退款\n                </button>\n                <button\n                        class=\"\n                         btn\n                         btn-block\n                         btn-ghost\n                         mb16\n                         \"\n                        v-if=\"cancelShow\"\n                        @click=\"cancelAction()\">撤销订单\n                </button>\n                <button\n                        class=\"\n                         btn\n                         btn-block\n                         btn-primary\n                         \"\n                        @click=\"ensureAction()\">确定\n                </button>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n    import {\n        Tag,\n        Col,\n        Icon,\n        Cell,\n        CellGroup,\n        Swipe,\n        Toast,\n        SwipeItem,\n        GoodsAction,\n        GoodsActionBigBtn,\n        GoodsActionMiniBtn\n    } from 'vant';\n    import storeData from './store/business-detail';\n    import ajax from '@/api/business';\n    import moment from 'moment';\n    import {orderStatus, refundStatus} from '@/filters/status';\n\n    export default {\n        components: {\n            [Tag.name]: Tag,\n            [Col.name]: Col,\n            [Icon.name]: Icon,\n            [Cell.name]: Cell,\n            [CellGroup.name]: CellGroup,\n            [Swipe.name]: Swipe,\n            [SwipeItem.name]: SwipeItem,\n            [GoodsAction.name]: GoodsAction,\n            [GoodsActionBigBtn.name]: GoodsActionBigBtn,\n            [GoodsActionMiniBtn.name]: GoodsActionMiniBtn,\n            Toast\n        },\n\n        data() {\n            return Object.assign(storeData.call(this), {\n                queryOrder: {\n                    orderNo: ''\n                },\n                queryOrderType: '',\n                businessInfo: {\n                    tradeStatusText: '', // 展示状态\n                    tradeOrderName: '',\n                    tradeAmount: '',\n                    tradeType: this.$route.query.tradeType,\n                    discountAmount: '',\n                    tradeOrderNo: '',\n                    operatorName: '',\n                    createTime: '',\n                    remark: ''\n                },\n                // orderStatus: '',\n                refundShow: false,\n                cancelShow: false,\n                overdrawStatus: false, // 是否超时30天,\n                resultForm: false, // 是否从退款状态页 来的\n                resultStatus: undefined, // 从退款状态页来的， 退款的成败状态\n                primaryNo: '', // resultForm,resultStatus基础上下个操作\n            });\n        },\n        created() {\n            this.queryOrder.orderNo = this.$route.query.tradeOrderNo;\n            this.queryOrderType = this.$route.query.tradeType === '1' ? 'pay' : this.$route.query.tradeType === '0' ? 'refund' : '';\n            this.primaryNo\n\n            this.getOrderDetail();\n\n            this.resultForm = this.$route.query.resultForm || false;\n            if (this.$route.query.resultForm) {\n                this.resultStatus = this.$route.query.resultStatus;\n            }\n        },\n        methods: {\n            getOrderDetail() {\n\n                if (this.queryOrderType === 'pay') {\n                    this.getPayDetail();\n                }\n\n                if (this.queryOrderType === 'refund') {\n                    this.getRefundDetail();\n                }\n            },\n\n            getPayDetail() {\n                ajax.getPay({payOrderNo: this.queryOrder.orderNo}).then(response => {\n                    if (!response.success === true) {\n                        this.businessInfo = {};\n                        return;\n                    } else {\n                        this.businessInfo = {\n                            ...this.businessInfo,\n                            tradeOrderName: response.data.payOrderName || '',\n                            tradeAmount: response.data.buyerPayAmount || '',\n                            discountAmount: response.data.discountAmount || '',\n                            tradeOrderNo: response.data.payOrderNo || '',\n                            operatorName: response.data.operName || '',\n                            createTime: response.data.createTime || '',\n                            remark: response.data.paySubmitRemark || '',\n                            tradeStatusText: orderStatus(response.data.payOrderStatus)\n                        };\n\n                        if (response.data.payOrderStatus === '2' ||\n                            response.data.payOrderStatus === 2) { //支付成功\n                            this.refundShow = true;\n                        } else {\n                            this.refundShow = false;\n                        }\n\n                        // 是否超过30天的逻辑\n                        if (response.data.createTime) {\n                            const thirtydaystime = moment(response.data.createTime).valueOf() + 30 * 24 * 60 * 60 * 1000;\n                            const currentTime = moment(new Date()).valueOf();\n\n                            if (thirtydaystime < currentTime) {\n                                this.overdrawStatus = true;\n                            } else {\n                                this.overdrawStatus = false;\n                            }\n                        }\n                    }\n                }).catch(() => {\n                    this.businessInfo = {};\n                });\n            },\n            getRefundDetail() {\n                ajax.getRefund({refundOrderNo: this.queryOrder.orderNo}).then(response => {\n                    if (!response.success === true) {\n                        this.businessInfo = {};\n                        return;\n                    } else {\n                        this.businessInfo = {\n                            ...this.businessInfo,\n                            tradeOrderName: response.data.payOrderName || '',\n                            tradeAmount: response.data.buyerPayAmount || '',\n                            discountAmount: response.data.discountAmount || '',\n                            operatorName: response.data.operName || '',\n                            createTime: response.data.createTime || '',\n                            remark: response.data.paySubmitRemark || ''\n                        };\n\n                        if (this.resultForm && this.resultStatus === '0') {\n                            this.primaryNo = response.data.payOrderNo;\n                        }\n                    }\n                }).catch(() => {\n                    this.businessInfo = {};\n                });\n            },\n            refundAction() {\n                setTimeout(() => {\n                    this.$router.push({\n                        name: 'businessRefund',\n                        query: {\n                            tradeOrderNo: this.$route.query.tradeOrderNo,\n                            amount: this.businessInfo.tradeAmount,\n                            tradeType: this.$route.query.tradeType\n                        }\n                    });\n                }, 800);\n            },\n            cancelAction() {\n                ajax.cancel({payOrderNo: this.queryOrder.orderNo}).then(response => {\n                    if (!response.success === true) {\n                        this.$toast(response.data.msg || '撤销订单失败');\n                        return;\n                    } else {\n\n                    }\n                }).catch(() => {\n                    this.$toast('撤销订单失败');\n                });\n            },\n            ensureAction() {\n                this.navBackClick();\n            },\n            primaryOrderAction() {\n                setTimeout(() => {\n                    this.$router.push({\n                        name: 'businessDetail',\n                        query: {\n                            tradeOrderNo: this.primaryNo,\n                            tradeType: '1',\n                        }\n                    });\n                }, 800);\n            },\n            navBackClick() {\n                setTimeout(() => {\n                    this.$router.push({\n                        name: 'business',\n                        query: {\n                            date: this.$route.query.date,\n                            orderStatusStr: this.$route.query.orderStatusStr\n                        }\n                    });\n                }, 800);\n            },\n        }\n    };\n</script>\n\n<style lang=\"less\" scoped>\n    @import \"../../style/formation.less\";\n\n    .business_detail-container {\n        background-color: @white;\n    }\n\n    .detail-item {\n        padding: 16px 0;\n        &-name,\n        &-title,\n        &-tip {\n            text-align: center;\n            line-height: 1.5;\n        }\n        &-name {\n            color: @text-color;\n            font-size: @font-normal;\n        }\n        &-title {\n            color: @text-color;\n            font-size: @font-largest;\n        }\n        &-tip {\n            color: @text-color-light;\n            font-size: @font-normal;\n        }\n    }\n\n    .overdraw-item {\n        font-size: @font-normal;\n        color: @text-color;\n        border-top: 1px solid @border-color;\n    }\n</style>\n"]}]}